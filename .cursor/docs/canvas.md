### **기능 설계 문서: FlowGenius Canvas & Community (v2.0)**

**중요:** 이 문서는 한국어로 작성되었으나, 실제 구현될 서비스의 모든 UI 텍스트, 예시, 콘텐츠는 **영어(English)**를 기준으로 합니다.

#### **1. 기능 개요 (Feature Overview)**

**1.1. 목표:**
AI 기반의 워크플로우 추천 기능과 시각적 설계의 자유도를 결합한 독창적인 경험을 제공합니다. 사용자는 자신만의 노하우가 담긴 워크플로우를 직접 설계하고, 이를 커뮤니티와 공유하여 집단 지성을 통해 함께 성장하는 생태계를 구축하는 것을 목표로 합니다.

**1.2. 핵심 기능:**
*   **워크플로우 캔버스:** 노드 기반의 자유로운 시각적 설계 환경.
*   **지능형 노드:** AI 추천 엔진과 연동되는 '서브태스크 노드'를 통해 자동화된 도구 추천 및 가이드 생성.
*   **완전한 사용자 제어:** AI가 생성한 모든 추천(도구, 가이드)에 대한 사용자의 자유로운 수정 및 편집.

---

#### **2. 워크플로우 캔버스 (Workflow Canvas)**

**2.1. 기술 기반:**
*   **라이브러리:** **`React Flow`**. 복잡한 커스텀 노드, 엣지 관리, 그리고 애플리케이션 상태와의 깊은 연동을 위해 '그리기' 도구가 아닌 '애플리케이션 구축'용 라이브러리를 채택합니다.

**2.2. 캔버스 구성요소:**

*   **기본 컴포넌트 (Standard Components):**
    *   **선택/이동 (Select/Move):** 노드 및 연결선 선택/이동.
    *   **기본 노드 (Shape Nodes):** 사각형(일반 작업), 마름모(의사 결정) 등 시각적 구분을 위한 기본 노드.
    *   **연결선 (Edges/Arrows):** 노드 간의 관계와 흐름을 정의하는 선.
    *   **주석 노드 (Text Node):** 캔버스에 메모나 설명을 추가하는 간단한 텍스트 노드.

*   **✨ 지능형 컴포넌트 (Intelligent Components - Custom React Flow Nodes):**

    *   **🧠 서브태스크 노드 (Subtask Node):**
        *   **설명:** 이 캔버스의 심장. FlowGenius AI 엔진과 상호작용하는 핵심 노드.
        *   **UI 구성:**
            1.  **태스크 입력 영역:** 사용자가 해결할 업무를 입력하는 텍스트 필드.
            2.  **상태 표시기:** `Idle(대기)`, `Analyzing(분석 중)`, `Recommended(추천 완료)`, `Guide Generated(가이드 생성됨)` 등 노드의 상태를 나타내는 뱃지.
            3.  **도구 슬롯:** 추천된 도구의 로고와 이름이 표시되는 영역.
            4.  **컨트롤 버튼:** 상황에 따라 나타나는 `✨ Generate Recommendations(추천 생성)`, `✏️ Edit Tool(도구 수정)`, `📄 Generate Guide(가이드 생성)` 버튼.

    *   **📄 가이드 카드 (Guide Card):**
        *   **설명:** 상세 사용법 가이드를 담는 독립된 컴포넌트.
        *   **UI 구성:**
            1.  **제목:** (예: "Guide for Midjourney: Creating Visuals for Reels")
            2.  **내용:** 단계별 가이드가 표시되는 영역 (Markdown 지원).
            3.  **펼치기/접기 토글:** 캔버스를 깔끔하게 유지하기 위해 내용을 숨기거나 보여주는 기능.

**2.3. 핵심 사용자 흐름 (Core User Flow):**

1. 메인테스크 노드에 사용자 업무 입력, 메인 태스크 노드는 캔버스 화면에 기본적으로 1개가 이미 세팅되어 있고, 이 노드는 더 추가하거나, 삭제할 수 없음. 
1.  **[노드 추가]** 사용자는 툴바에서 `🧠 서브태스크 노드`를 클릭한 후, 원하는 위치에 원하는 크기만큼 드래그하여 생성. 
2.  **[업무 입력]** 노드를 더블 클릭하여 해결할 업무를 입력합니다. (예: "Generate compelling visual assets for the Reels video")
3.  **[도구 매칭 요청]** 도구 매칭 관련 버튼이 활성화되고, 사용자가 이를 클릭합니다.
4.  **[AI 분석]** 노드의 상태가 `Analyzing`으로 변경되며 로딩 애니메이션이 표시됩니다. 백엔드에서는 이미 구현된 `/api/tools/smart-recommend`가 호출됩니다.
5.  **[결과 표시]** API 응답이 도착하면, 최종 선택된 도구(예: Midjourney)가 '도구 슬롯'에 자동으로 채워집니다. 노드 상태는 `Recommended`로 변경됩니다.
6.  **[사용자 제어 및 구체화]**
    *   **도구 수정:** 추천된 도구가 마음에 들지 않으면, `✏️ Edit Tool` 버튼을 클릭합니다. DB에 저장된 다른 도구를 검색하여 교체할 수 있는 모달이 나타납니다.
    *   **가이드 생성:** 사용자는 최종 선택된 도구에 대한 `📄 Generate Guide` 버튼을 클릭합니다.
7.  **[가이드 생성]** 이미 구현된 `/api/tools/[tool_id]/guide/stream` API가 호출됩니다. 생성된 가이드는 `📄 가이드 카드` 형태로 캔버스에 나타나고, 자동으로 `서브태스크 노드`와 연결선이 그어집니다. 가이드는 기본적으로 크기가 크므로, 가이드 아이콘 (접힘/ 열림) 상태가 존재하여 가이드를 한눈에 확인하거나, 전체 플로우를 확인하기 위해 잠시 접어둘 수 있습니다. 
8.  **[최종 설계]** 사용자는 이 지능형 노드들과 기본 노드, 주석, 화살표를 자유롭게 조합하여 전체 워크플로우 맵을 완성합니다. **AI가 생성한 가이드 카드 안의 텍스트 또한 사용자가 직접 편집할 수 있습니다.**
